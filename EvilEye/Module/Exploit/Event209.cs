using EvilEye.SDK;
using EvilEye.SDK.ButtonAPI;
using EvilEye.SDK.Photon;
using ExitGames.Client.Photon;
using MelonLoader;
using Photon.Pun;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnityEngine;

namespace EvilEye.Module.Exploit
{
    class Event209 : BaseModule
    {
        public Event209() : base("Event209", "Desync Lobby", Main.Instance.exploistButton, Main.Instance.quickMenuStuff.Button_AvatarsIcon.sprite, true) { }

        public override void OnEnable()
        {
            MelonCoroutines.Start(Desync());
        }


        IEnumerator Desync()
        {
            PhotonView[] photonViews = Resources.FindObjectsOfTypeAll<PhotonView>();

            while (this.toggled)
            {
                for (int j = 0; j < 2; j++)
                {
                    for (int i = 0; i < photonViews.Length; i++)
                    {
                        PhotonExtensions.OpRaiseEvent(209, new int[]
                        {
                            photonViews[i].viewIdField,
                            VRC.Player.prop_Player_0.prop_VRCPlayerApi_0.playerId
                        }, new Photon.Realtime.RaiseEventOptions
                        {
                            field_Public_ReceiverGroup_0 = Photon.Realtime.ReceiverGroup.All,
                            field_Public_EventCaching_0 = Photon.Realtime.EventCaching.DoNotCache
                        }, default(SendOptions));
                    }
                }

                yield return new WaitForSecondsRealtime(0.025f);
            }
            yield break;
        }
    }
}
